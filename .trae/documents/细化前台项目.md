# 前台项目细化需求说明

## 背景与目标
- 提升设备列表、资产列表与详情页的可读性与美观度，优化搜索与筛选体验。
- 为设备详情页引入时序数据的可视化能力，支持多指标、区间与实时刷新。
- 完善资产详情页的信息结构，确保页面信息更丰富、交互更顺畅。
- 规范前台地图页面的显示逻辑：低缩放显示资产，高缩放显示设备；标签以资产的 `stationName`/设备名称作为标题，支持弹出信息与跳转详情。

## 范围
- 设备列表页与资产列表页：表格外观美化、搜索与筛选增强、列表交互优化。
- 设备详情页：时序数据可视化模块与整体视觉美化、信息结构优化。
- 资产详情页：信息架构重组与视觉统一，美化并增加统计与关联信息。
- 前台地图页面：资产/设备分级显示逻辑、标签与弹出信息、跳转行为与性能优化。

## 功能需求

### 一、设备列表页与资产列表页
- 表格美化：统一行高、边框与悬停态；优化空状态与加载占位；支持响应式。
- 列配置：
  - 设备列表：名称、设备ID、所属资产、状态、最后上报时间、位置/坐标、类型等。
  - 资产列表：资产名称、`stationName`、资产ID、地域/坐标、包含设备数、状态、最后更新时间等。
- 搜索与筛选：
  - 关键字搜索（名称/ID），下拉筛选（状态、资产、类型），时间范围（创建/最后上报）。
  - 高级筛选抽屉：多条件组合、条件记忆、重置与保存为常用筛选。
- 交互增强：
  - 列宽拖拽、列显示/隐藏，行点击进入详情，批量选择与导出（CSV）。
  - 分页优化：每页条数可选；记忆最近一次筛选与分页状态；空结果引导。

#### 修改范围与约束（仅两个列表页）
- 仅对“设备列表页”和“资产列表页”进行改造；不批量调整全局样式或其他页面。
- 使用局部样式（SFC `scoped`）与现有组件库，避免修改 `src/design/index.less` 等全局文件。
- 采用“精确覆写”策略：通过构建期 alias 将原列表页映射到覆写文件，避免直接改动上游源文件。
  - 示例：`/@/views/tb/device/list.vue` → `src/overrides/tb/device/list.vue`
  - 示例：`/@/views/tb/asset/list.vue` → `src/overrides/tb/asset/list.vue`

#### 设备列表页详细规格
- 工具栏：
  - 左侧：关键字搜索（支持名称/ID），状态筛选（在线/离线/全部），资产筛选（下拉/可搜索），类型筛选。
  - 右侧：刷新、重置、列设置（显示/隐藏/顺序）、导出选中为 CSV。
- 列与排序：
  - 必选列：设备名称（可点击跳详情）、设备ID、所属资产、状态（含颜色标签）、最后上报时间、类型。
  - 可选列：位置/坐标、标签、创建时间；支持按“最后上报时间/创建时间”排序。
- 筛选与记忆：
  - 高级筛选抽屉支持多条件组合；提供“重置”和“保存筛选方案”。
  - 记忆最近一次筛选与分页状态（基于路由查询或本地缓存）。
- 行与选择：
  - 行点击进入设备详情；支持复选框批量选择，批量导出。
- 空/加载状态：骨架屏与空提示（含返回列表链接），异常提示与重试按钮。
- 响应式：在窄屏合并次要列为标签行内显示；工具栏折叠为下拉。

#### 资产列表页详细规格
- 工具栏：
  - 左侧：关键字搜索（资产名称/`stationName`/ID）、状态筛选、地域筛选（区域/城市）、类型筛选。
  - 右侧：刷新、重置、列设置、导出选中为 CSV。
- 列与排序：
  - 必选列：资产名称（可点击跳详情）、`stationName`、资产ID、包含设备数、状态、最后更新时间。
  - 可选列：地域/坐标、标签、负责人；支持按“设备数/最后更新时间”排序。
- 筛选与记忆：
  - 高级筛选抽屉支持地域、类型、状态、标签组合；支持保存与重置。
  - 记忆最近一次筛选与分页状态。
- 行与选择：
  - 行点击进入资产详情；支持复选框批量选择，批量导出。
- 空/加载与响应式：同设备列表页规范。

#### 技术实现与集成（仅列表页）
- 数据：沿用现有列表接口（分页+条件查询）；前端通过查询参数构建请求。
- 组件：沿用现有表格与表单组件；列设置与导出复用项目已有能力或简单扩展。
- 样式：SFC 局部样式，统一行高（示例 44px）、悬停态与标签色板；不改动全局样式文件。
- 路由与权限：复用既有路由与权限拦截；列表页行为完全兼容现有登录态与菜单。

#### 验收项（列表页）
- 搜索与筛选生效，组合筛选结果正确；重置/保存筛选方案正常。
- 列显隐、排序与列宽拖拽工作正常；状态与时间字段展示准确。
- 行点击跳转详情；批量选择与导出选中为 CSV 正常。
- 空/加载/异常状态表现符合规范；响应式在窄屏下可读性良好。

### 二、设备详情页（含时序可视化）
- 概览信息卡片：设备基本信息、在线状态、所属资产、最后上报/心跳、位置与标签。
- 时序数据可视化：
  - 指标选择（支持多个指标）、时间区间选择（最近15分钟/1小时/1天/自定义）。
  - 统计维度：原始、聚合（均值/最大值/最小值/总和）；支持多轴与单位显示。
  - 实时刷新（可配置刷新间隔），缺失数据与异常点标记；区间缩放与拖拽。
  - 数据导出（CSV/JSON）与图表截图保存。
- 事件与告警：时间轴展示近期事件/告警条目，可跳转到事件详情。
- 地理位置卡片：当前坐标与在地图上的定位入口。
- 视觉与布局：统一色彩与组件风格，采用栅格布局，移动端适配。

### 三、资产详情页
- 概览：资产基本信息、`stationName`、类型、位置、包含设备数、健康度评分。
- 统计与关联：
  - 设备统计（数量、在线/离线占比），近7天数据趋势图（请求量/告警数）。
  - 关联信息：维护/工单记录、联系人与站点信息、标签。
- 地图与导航：资产位置、附近设备概览入口；支持跳转设备列表与地图。
- 视觉与布局：页面栅格化、模块卡片化、统一配色，移动端适配。

### 四、前台地图页面（资产与设备分级显示）
- 缩放级别逻辑：
  - 低缩放（示例：`zoom <= 8`）显示资产；高缩放（示例：`zoom >= 9`）显示设备。
  - 可在配置项中调整阈值以符合实际使用场景。
- 数据加载与范围：
  - 按视窗范围（bbox）请求资产/设备数据；服务端分页/分片；避免全量加载。
  - 采用聚合策略（marker clustering）减少密集点遮挡；缩放或拖动时增量更新。
- 标签与弹出：
  - 资产固定便签：标题使用资产 `stationName`；弹出内容含基础信息与操作入口；支持点击跳转资产详情页。
  - 设备标签：标题为设备名称或ID；弹出内容含状态与最近上报；支持点击跳转设备详情页。
- 过滤与权限：
  - 地图上支持按组织/资产类型/设备状态进行快速过滤；遵循用户权限过滤数据。
- 性能与体验：
  - 节流与防抖处理视图交互；首次加载显示骨架屏；错误与空状态友好提示。

## 交互与UI规范
- 色彩与组件：遵循现有设计系统与组件库风格，统一按钮、输入框、标签形态。
- 排版与可读性：合理留白，列表密度可选；信息卡片化分组；强调重点信息（状态、告警）。
- 动效与反馈：加载、切换与筛选提供轻量动效；操作后明确反馈与可撤销（如筛选重置）。
- 可访问性与国际化：支持键盘导航与 aria 属性；中文/英文双语文案完整覆盖。

## 数据与接口约定（示例）
- 列表接口：`GET /api/devices`、`GET /api/assets`，支持分页、关键字、状态、类型、时间范围的查询参数。
- 详情接口：`GET /api/devices/{id}`、`GET /api/assets/{id}`，返回基础信息与扩展字段。
- 时序数据：`GET /api/timeseries`，参数包含 `entityId`、`metric[]`、`agg`、`interval`、`start/end`，返回点集与统计。
- 地图数据：`GET /api/map/entities`，参数包含 `bbox`、`zoom`、`type`（asset/device）、过滤项；返回 `id`、`name`/`stationName`、`lat`、`lng`、`status`、`lastTs` 等。
- 字段规范：统一使用 `id`、`name`、`stationName`、`status`、`tags`、`lastTs`；坐标为 `lat/lng` 浮点数。

## 集成与约束
- 路由：新增页面路由以模块形式放在 `src/router/routes/modules/`，页面位于 `src/views/tdiot/**`。
- 国际化：新增词条至 `src/locales/lang/zh-CN/tdiot/**` 与 `src/locales/lang/en/tdiot/**`，动态聚合。
- Store 与 API：业务接口置于 `src/api/tdiot/**`，状态管理在 `src/store/modules/tdiot/**`。
- 不侵入上游：避免改动上游核心文件；必要时使用构建期 alias 精确覆写。

## 性能与兼容性
- 列表：分页与服务端过滤；一次渲染项数限制；懒加载非首屏模块。
- 图表：大数据量下采用采样/抽稀与窗口渲染；实时刷新节流。
- 地图：视窗增量加载、聚合与去重；移动端手势优化；GPU 加速（视库而定）。
- 浏览器支持：现代浏览器与常见移动端；退化方案与 polyfill 由构建链路保证。

## 验收标准
- 列表页：筛选准确、分页稳定、导出正常、交互反馈清晰；空/异常状态处理完善。
- 设备详情：时序图表正确显示与交互；多指标与聚合正常；实时刷新稳定。
- 资产详情：信息完整、统计与关联数据准确；页面布局美观且响应式良好。
- 地图：缩放阈值切换资产/设备显示正确；标签标题与弹出信息完整；跳转行为准确。
- 国际化与权限：词条完整、权限过滤生效；无泄漏数据；无明显性能问题（首屏 <2s，交互 <100ms）。

## 里程碑与计划（示例）
- M1（列表与筛选，1周）：完成表格美化、搜索/筛选、分页与导出。
- M2（设备详情与时序，1.5周）：完成概览卡片、时序图表与交互、事件/告警模块。
- M3（资产详情与地图，1.5周）：完成资产信息重构、统计模块与地图显示逻辑。
- M4（打磨与验收，1周）：性能优化、国际化完善、回归测试与验收。

## 风险与假设
- 地图与图表库选型以现有依赖为准；如需更换需评估负载与开发成本。
- 后端接口需支持 bbox/zoom 与聚合查询；若暂缺，先以前端降级处理（采样/聚合）。
- 数据量与权限模型可能影响性能与缓存策略；需结合实际数据分布调优。

—— 本文档用于指导前台页面的细化实现与验收，实际实现以项目现有架构与依赖为准 ——
